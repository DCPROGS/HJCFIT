

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The \(Q\)-matrix &mdash; DCProgs 0.9 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/breathe.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="DCProgs 0.9 documentation" href="../index.html" />
    <link rel="up" title="User Guide" href="../manual.html" />
    <link rel="next" title="Likelihood \(L(Q)\)" href="likelihood_of_Q.html" />
    <link rel="prev" title="User Guide" href="../manual.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="likelihood_of_Q.html" title="Likelihood \(L(Q)\)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../manual.html" title="User Guide"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">DCProgs 0.9 documentation</a> &raquo;</li>
          <li><a href="../manual.html" accesskey="U">User Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-matrix">
<span id="manual-qmatrix"></span><h1>The <span class="math">\(Q\)</span>-matrix<a class="headerlink" href="#the-matrix" title="Permalink to this headline">Â¶</a></h1>
<p>The <span class="math">\(Q\)</span>-matrix represents the most basic data structure of this library. It holds the rates
between different states in the mechanism, for open and shut states. In practice, it can be
represented by a matrix of rates and the number of open states. As such, the initialization takes
both of these input:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">python:</th><td class="field-body"><p class="first">The input array must be square. It can be any type that is convertible to a numpy array of reals.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">sum</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="nb">all</span>
<span class="kn">from</span> <span class="nn">dcprogs.likelihood</span> <span class="kn">import</span> <span class="n">QMatrix</span>

<span class="n">matrix</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="o">-</span><span class="mi">3050</span><span class="p">,</span>        <span class="mi">50</span><span class="p">,</span>  <span class="mi">3000</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span> 
           <span class="p">[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1502.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>    <span class="mi">500</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span> 
           <span class="p">[</span>   <span class="mi">15</span><span class="p">,</span>         <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2065</span><span class="p">,</span>     <span class="mi">50</span><span class="p">,</span> <span class="mi">2000</span><span class="p">],</span> 
           <span class="p">[</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">15000</span><span class="p">,</span>  <span class="mi">4000</span><span class="p">,</span> <span class="o">-</span><span class="mi">19000</span><span class="p">,</span>    <span class="mi">0</span><span class="p">],</span> 
           <span class="p">[</span>    <span class="mi">0</span><span class="p">,</span>         <span class="mi">0</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>  <span class="o">-</span><span class="mi">10</span><span class="p">]</span> <span class="p">]</span>

<span class="n">qmatrix</span> <span class="o">=</span> <span class="n">QMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
 
<span class="k">print</span><span class="p">(</span><span class="n">qmatrix</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">c++11:</th><td class="field-body"><div class="first last highlight-c++"><div class="highlight"><pre><span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &lt;typeinfo&gt;</span>

<span class="cp">#include &lt;exception&gt;</span>
<span class="cp">#include &lt;likelihood/qmatrix.h&gt;</span>
 

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="n">DCProgs</span><span class="o">::</span><span class="n">t_rmatrix</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">5</span> <span class="p">,</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">matrix</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="mi">3050</span><span class="p">,</span>        <span class="mi">50</span><span class="p">,</span>  <span class="mi">3000</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> 
            <span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1502.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>    <span class="mi">500</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>  
               <span class="mi">15</span><span class="p">,</span>         <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2065</span><span class="p">,</span>     <span class="mi">50</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span>  
                <span class="mi">0</span><span class="p">,</span>     <span class="mi">15000</span><span class="p">,</span>  <span class="mi">4000</span><span class="p">,</span> <span class="o">-</span><span class="mi">19000</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>  
                <span class="mi">0</span><span class="p">,</span>         <span class="mi">0</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>  <span class="o">-</span><span class="mi">10</span><span class="p">;</span>

  <span class="n">DCProgs</span><span class="o">::</span><span class="n">QMatrix</span> <span class="n">qmatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="cm">/*nopen=*/</span><span class="mi">2</span><span class="p">);</span>
 
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">qmatrix</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
 
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>In both cases, the open-open transitions <em>must</em> be located in the top-left corner of the input
matrix.</p>
<p><tt class="xref cpp cpp-class docutils literal"><span class="pre">QMatrix</span></tt> is a structure instance, without private members. Hence both the matrix and
number of open states can be accessed directly. In the following, we show access to <cite>nopen</cite> and to
the rates. Among other things, the code below verifies that the rates of the CH82 model do sum to
zero over rows (this condition is not enforced by the <tt class="xref cpp cpp-class docutils literal"><span class="pre">QMatrix</span></tt> object).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">python:</th><td class="field-body"><p class="first">The matrix is a numpy array. As such, it can be used within any of the efficient numerical
algorithms provided. There are some restrictions if this package is compiled with 128 bit reals.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">assert</span> <span class="n">qmatrix</span><span class="o">.</span><span class="n">nopen</span> <span class="o">==</span> <span class="mi">2</span>
<span class="k">assert</span> <span class="n">qmatrix</span><span class="o">.</span><span class="n">nshut</span> <span class="o">==</span> <span class="mi">3</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">qmatrix</span><span class="o">.</span><span class="n">matrix</span> <span class="o">-</span> <span class="n">matrix</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">)</span>

  
<span class="c"># Compute sum over rows, row by row.</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qmatrix</span><span class="o">.</span><span class="n">matrix</span><span class="p">):</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;sum(row[{0}]) = {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">)))</span>

<span class="c"># Compute sum over rows, but let numpy do it.</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Sum over rows: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">qmatrix</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
  
<span class="c"># Check that sum over rows returns zero.</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">qmatrix</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">c++11:</th><td class="field-body"><p class="first">The matrix is an <a class="reference external" href="http://eigen.tuxfamily.org/index.php?title=Main_Page">eigen</a> array. Many linear algebra operations can be performed very efficiently
using <a class="reference external" href="http://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a>&#8216;s interface.</p>
<div class="last highlight-c++"><div class="highlight"><pre>  <span class="k">if</span><span class="p">(</span><span class="n">qmatrix</span><span class="p">.</span><span class="n">nopen</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">qmatrix</span><span class="p">.</span><span class="n">nshut</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="p">((</span><span class="n">qmatrix</span><span class="p">.</span><span class="n">matrix</span> <span class="o">-</span> <span class="n">matrix</span><span class="p">).</span><span class="n">array</span><span class="p">().</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">1e-12</span><span class="p">).</span><span class="n">any</span><span class="p">()</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  
  <span class="c1">// Compute sum over rows, row by row.</span>
  <span class="k">for</span><span class="p">(</span><span class="n">DCProgs</span><span class="o">::</span><span class="n">t_int</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qmatrix</span><span class="p">.</span><span class="n">matrix</span><span class="p">.</span><span class="n">rows</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> 
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;sum(row[&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;]): &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">qmatrix</span><span class="p">.</span><span class="n">matrix</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="c1">// Compute sum over rows, but let eigen do it.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Sum over rows: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">qmatrix</span><span class="p">.</span><span class="n">matrix</span><span class="p">.</span><span class="n">rowwise</span><span class="p">().</span><span class="n">sum</span><span class="p">().</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  
  <span class="c1">// Check that sum over rows returns zero.</span>
  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">qmatrix</span><span class="p">.</span><span class="n">matrix</span><span class="p">.</span><span class="n">rowwise</span><span class="p">().</span><span class="n">sum</span><span class="p">().</span><span class="n">array</span><span class="p">().</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">).</span><span class="n">any</span><span class="p">()</span> <span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="p">();</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Finally, the blocks of the  <span class="math">\(Q\)</span> can be accessed efficiently via functions (or properties in
python). These are wrappers around the rate matrix. These wrappers are numerically efficient. They
can and <em>should</em> be used within numerical algorithms.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">python:</th><td class="field-body"><div class="first highlight-python"><div class="highlight"><pre><span class="c"># Gets AA block.</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;AA block:</span><span class="se">\n</span><span class="s">---------</span><span class="se">\n</span><span class="s">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qmatrix</span><span class="o">.</span><span class="n">aa</span><span class="p">))</span>
                
<span class="c"># aa is simply wrapper around the matrix block </span>
<span class="n">qmatrix</span><span class="o">.</span><span class="n">aa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">qmatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">42</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">c++11:</th><td class="field-body"><div class="first last highlight-c++"><div class="highlight"><pre>  <span class="c1">// Gets AA block.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;AA block:</span><span class="se">\n</span><span class="s">---------</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">qmatrix</span><span class="p">.</span><span class="n">aa</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                
  <span class="c1">// aa returns a wrapper around the matrix block. Hence memory is the same.</span>
  <span class="k">if</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">qmatrix</span><span class="p">.</span><span class="n">aa</span><span class="p">()(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">qmatrix</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="p">();</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="../manual.html"
                        title="previous chapter">User Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="likelihood_of_Q.html"
                        title="next chapter">Likelihood <span class="math">\(L(Q)\)</span></a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/manual/qmatrix.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="likelihood_of_Q.html" title="Likelihood \(L(Q)\)"
             >next</a> |</li>
        <li class="right" >
          <a href="../manual.html" title="User Guide"
             >previous</a> |</li>
        <li><a href="../index.html">DCProgs 0.9 documentation</a> &raquo;</li>
          <li><a href="../manual.html" >User Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Mayeul d&#39;Avezac.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>